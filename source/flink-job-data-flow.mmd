---
config:
  theme: redux
---
flowchart LR
    %% Legend
    subgraph Legend[ ]
      direction TB
      L1[<b>Legend</b>]:::legendHeader
      L2[<span style="color:#2980b9;"><b>Blue</b></span> = Stateless transformation]:::legendEntry
      L3[<span style="color:#f39c12;"><b>Orange</b></span> = Side-effects / External IO]:::legendEntry
    end

    %% Main DAG
    subgraph Flink Job
        A["Raw Kafka Topic"]:::source
        B["Normalise"]:::stateless
        C["Deduplicate"]:::stateless
        D["Enrich<br/>(modular rules)"]:::stateless
        E["Upsert to NoSQL<br/>(exactly-once)"]:::sideEffect
        F["Emit<br/>cache.invalidate"]:::sideEffect
    end

    A --> B
    B --> C
    C --> D
    D --> E
    E --> F

    classDef source fill:#bdc3c7,stroke:#333,stroke-width:1px;
    classDef stateless fill:#2980b9,color:#fff,stroke:#1c5a89;
    classDef sideEffect fill:#f39c12,color:#fff,stroke:#c87f0a;
    classDef legendHeader fill:#ffffff,color:#000,stroke-width:0px;
    classDef legendEntry fill:#ffffff,color:#000,stroke-width:0px;
